<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SLITHER GOD FIX</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="menu">
    <h1>SLITHER GOD FIX</h1>
    <button onclick="startGame()">START</button>
</div>

<div class="ui">
    Score: <span id="score">0</span><br>
    Energy: <span id="energy">100</span>
    <button id="boostBtn">BOOST</button>
</div>

<div id="joystick"><div id="stick"></div></div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let worldSize=3000;
let zoneRadius=1200;

let snake=[], bots=[], foods=[];
let dir={x:1,y:0};
let score=0, energy=100;
let boost=false, alive=false;
let camera={x:0,y:0};

function startGame(){
document.getElementById("menu").style.display="none";
resetGame();
alive=true;
}

function resetGame(){
snake=[{x:worldSize/2,y:worldSize/2}];
bots=[];
foods=[];
score=0;
energy=100;
zoneRadius=1200;

for(let i=0;i<150;i++) spawnFood();
for(let i=0;i<5;i++) spawnBot();
}

function spawnFood(){
foods.push({
x:Math.random()*worldSize,
y:Math.random()*worldSize,
r:5
});
}

function spawnBot(){
bots.push({
body:[{x:Math.random()*worldSize,y:Math.random()*worldSize}],
dir:{x:Math.random()-0.5,y:Math.random()-0.5},
score:0,
alive:true
});
}

// Mouse control
document.addEventListener("mousemove",e=>{
let dx=e.clientX-canvas.width/2;
let dy=e.clientY-canvas.height/2;
let mag=Math.hypot(dx,dy);
if(mag>0){
dir.x=dx/mag;
dir.y=dy/mag;
}
});

// Joystick mobile
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");

joy.addEventListener("touchmove",e=>{
e.preventDefault();
let rect=joy.getBoundingClientRect();
let x=e.touches[0].clientX-rect.left-50;
let y=e.touches[0].clientY-rect.top-50;
let mag=Math.hypot(x,y);
if(mag>0){
dir.x=x/mag;
dir.y=y/mag;
}
});
joy.addEventListener("touchend",()=>{dir={x:1,y:0};});

// Boost
document.getElementById("boostBtn").onmousedown=
document.getElementById("boostBtn").ontouchstart=()=>boost=true;
document.getElementById("boostBtn").onmouseup=
document.getElementById("boostBtn").ontouchend=()=>boost=false;

function update(){
if(!alive) return;

let head=snake[0];
let speed=boost && energy>0?5:2.5;

if(boost && energy>0){
energy-=0.5;
if(snake.length>20) snake.pop();
}else{
if(energy<100) energy+=0.2;
}

let newHead={
x:head.x+dir.x*speed,
y:head.y+dir.y*speed
};

snake.unshift(newHead);

// Zone check
if(Math.hypot(newHead.x-worldSize/2,newHead.y-worldSize/2)>zoneRadius){
die();
}

foods.forEach((f,i)=>{
if(Math.hypot(f.x-newHead.x,f.y-newHead.y)<10){
foods.splice(i,1);
spawnFood();
score+=10;
}
});

if(snake.length>score/10+20) snake.pop();

// Bot simple AI
bots.forEach(bot=>{
if(!bot.alive) return;
let head=bot.body[0];
let dx=snake[0].x-head.x;
let dy=snake[0].y-head.y;
let mag=Math.hypot(dx,dy);
if(mag>0){
bot.dir.x=dx/mag;
bot.dir.y=dy/mag;
}
head.x+=bot.dir.x*2;
head.y+=bot.dir.y*2;

bot.body.unshift({x:head.x,y:head.y});
if(bot.body.length>20) bot.body.pop();

if(Math.hypot(head.x-snake[0].x,head.y-snake[0].y)<10){
die();
}
});

// shrink zone pelan
if(zoneRadius>300) zoneRadius-=0.02;

camera.x=newHead.x-canvas.width/2;
camera.y=newHead.y-canvas.height/2;

document.getElementById("score").innerText=score;
document.getElementById("energy").innerText=Math.floor(energy);
}

function die(){
alive=false;
setTimeout(()=>{
document.getElementById("menu").style.display="flex";
},500);
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

// zone
ctx.strokeStyle="red";
ctx.beginPath();
ctx.arc(worldSize/2-camera.x,worldSize/2-camera.y,zoneRadius,0,Math.PI*2);
ctx.stroke();

// food
foods.forEach(f=>{
ctx.fillStyle="white";
ctx.beginPath();
ctx.arc(f.x-camera.x,f.y-camera.y,5,0,Math.PI*2);
ctx.fill();
});

// player
snake.forEach((s,i)=>{
ctx.fillStyle=i==0?"#ffffff":"#00ff88";
ctx.beginPath();
ctx.arc(s.x-camera.x,s.y-camera.y,8,0,Math.PI*2);
ctx.fill();
});

// bots
bots.forEach(bot=>{
bot.body.forEach((b,i)=>{
ctx.fillStyle=i==0?"#fff":"#ff4444";
ctx.beginPath();
ctx.arc(b.x-camera.x,b.y-camera.y,8,0,Math.PI*2);
ctx.fill();
});
});
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
